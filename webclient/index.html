<!DOCTYPE html>

<html>
    <head>
        <title>Title</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/uikit.min.css" />
        <script src="js/uikit.min.js"></script>
        <script src="js/uikit-icons.min.js"></script>
        <style>
            /*
            * ExtraSmall
            */
            /* Horizontal */
            .uk-grid-extra-small,
            .uk-grid-column-small {
            margin-left: -7.5px;
            }
            .uk-grid-extra-small > *,
            .uk-grid-column-small > * {
            padding-left: 7.5px;
            }
            /* Vertical */
            .uk-grid + .uk-grid-extra-small,
            .uk-grid + .uk-grid-row-small,
            .uk-grid-extra-small > .uk-grid-margin,
            .uk-grid-row-small > .uk-grid-margin,
            * + .uk-grid-margin-small {
            margin-top: 7.5px;
            }

            .bg-col-amount {
                text-align: right;
            }
        </style>
        <script>
            var data = [
            {
                "date": "2021-08-10",
                "category": "Income",
                "name": "Josh - Auto Insurance",
                "amount": 29.17
            },
            {
                "date": "2021-08-06",
                "category": "Income",
                "name": "Interest",
                "amount": 0.01
            },
            {
                "date": "2021-08-06",
                "category": "Income",
                "name": "Josh - Renters Ins.",
                "amount": 27.92
            },
            {
                "date": "2021-08-06",
                "category": "Income",
                "name": "Joshua Phone",
                "amount": 37.5
            },
            {
                "date": "2021-08-06",
                "category": "Income",
                "name": "Kari Owes",
                "amount": 185.07
            },
            {
                "date": "2021-08-06",
                "category": "Income",
                "name": "Kari Owes",
                "amount": -185.07
            },
            {
                "date": "2021-08-06",
                "category": "Income",
                "name": "Kiva Phone",
                "amount": 76.42
            },
            {
                "date": "2021-08-06",
                "category": "Income",
                "name": "Wells Fargo",
                "amount": 21.16
            },
            {
                "date": "2021-08-06",
                "category": "Utilities",
                "name": "Garbage",
                "amount": -28.22
            },
            {
                "date": "2021-08-09",
                "category": "Utilities",
                "name": "XCel",
                "amount": -218.76
            },
            {
                "date": "2021-08-06",
                "category": "Food",
                "name": "Groceries",
                "amount": -18.81
            },
            {
                "date": "2021-08-06",
                "category": "Food",
                "name": "Groceries",
                "amount": -52.19
            },
            {
                "date": "2021-08-06",
                "category": "Food",
                "name": "Mike's Lunches",
                "amount": -5.58
            },
            {
                "date": "2021-08-06",
                "category": "Food",
                "name": "Mike's Lunches",
                "amount": -9.66
            },
            {
                "date": "2021-08-06",
                "category": "Food",
                "name": "Mike's Lunches",
                "amount": -29.94
            },
            {
                "date": "2021-08-06",
                "category": "Insurance",
                "name": "Renters",
                "amount": -27.92
            },
            {
                "date": "2021-08-12",
                "category": "Personal",
                "name": "Amazon Prime",
                "amount": -13.83
            },
            {
                "date": "2021-08-06",
                "category": "Personal",
                "name": "Caleb",
                "amount": -5
            },
            {
                "date": "2021-08-06",
                "category": "Personal",
                "name": "Gifts 2021",
                "amount": -58.54
            },
            {
                "date": "2021-08-06",
                "category": "Personal",
                "name": "Kari",
                "amount": 5
            },
            {
                "date": "2021-08-06",
                "category": "Personal",
                "name": "Kari",
                "amount": 5
            },
            {
                "date": "2021-08-06",
                "category": "Personal",
                "name": "Kari",
                "amount": -17.76
            },
            {
                "date": "2021-08-06",
                "category": "Personal",
                "name": "Kari 20%",
                "amount": -39
            },
            {
                "date": "2021-08-08",
                "category": "Debt",
                "name": "Student Loans - Kari",
                "amount": -67.34
            },
            {
                "date": "2021-08-08",
                "category": "Debt",
                "name": "Student Loans - Kari Nelnet",
                "amount": -50
            }
        ];

        const formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
        });

        function createMenuItem(icon, tooltip, record) {
            let result = document.createElement('li');
            let button = document.createElement('a');
            
            result.append(button);
            button.href = '#';
            UIkit.icon(button, {icon: icon});
            UIkit.tooltip(button, {title: tooltip});

            button.addEventListener('click', (e) => {
                e.preventDefault();
                switch (icon) {
                    case 'trash':
                        UIkit.modal.confirm('Delete this transaction?').then(() => {
                            console.log(`OK clicked, removing record-${record}`);
                            document.getElementById(`record-${record}`).remove();
                        }, () => {});
                        break;
                    case 'file-edit':
                        break;
                    
                    case 'future':
                        break;
                }
            });

            return result;
        }

        function createBadgeItem(icon, tooltip) {
            let result = document.createElement('span');
            UIkit.icon(result, {icon: icon});
            UIkit.tooltip(result, {title: tooltip});

            return result;
        }

        window.addEventListener('load', () => { //return;
            let category = 'Income';
            let color = 'default';

            data.map((rec, idx) => {
                if (rec.category !== category) {
                    color = color === 'default' ? 'primary' : 'default';
                    category = rec.category;
                }

                let container = document.createElement('div');
                container.id = `record-${idx}`;
                container.className = `uk-card uk-card-body uk-card-${color} uk-width-1-1`;

                let badges = document.createElement('div');
                badges.className = 'uk-card-badge uk-label';
                badges.append(createBadgeItem('calendar', 'Scheduled'));
                container.append(badges);

                let menu = document.createElement('ul');
                menu.className = 'uk-iconnav';
                menu.append(createMenuItem('file-edit', 'Edit', idx));
                menu.append(createMenuItem('trash', 'Delete', idx));

                if (rec.recurring) {
                    let recurring = createMenuItem('future', 'Edit Recurring', idx);
                    menu.append(recurring);
                }
                container.append(menu);

                let title = document.createElement('h3');
                title.className = 'uk-card-title';
                title.append(document.createTextNode(`${rec.category}: ${rec.name}`))
                container.append(title);

                let grid = document.createElement('div');
                grid.className = 'uk-child-1-1';

                let dateCard = document.createElement('div');
                let date = new Date(rec.date);
                dateCard.className = `uk-width-expand`;
                dateCard.append(document.createTextNode(date.toLocaleDateString(undefined, {year: 'numeric', month: 'short', day: 'numeric'})));
                UIkit.leader(dateCard);
                grid.append(dateCard);

                let amountCard = document.createElement('div');
                amountCard.append(document.createTextNode(formatter.format(rec.amount)));
                grid.append(amountCard);

                UIkit.grid(grid);
                container.append(grid);

                // let divider = document.createElement('hr');
                // divider.className = 'uk-divider-icon';
                // container.append(divider);

                document.getElementById('main').append(container);
            });

            // add a mutation observer to viewport to adjust the max-height 
            // style whenever the min-height changes. UIkit handles the
            // min-height adjustment already
            function adjustViewport() {
                let el = document.getElementById('viewport');
                if (el.style.minHeight !== el.style.maxHeight) {
                    el.style.maxHeight = el.style.minHeight;
                    el.style.overflowY = 'scroll';
                }
            }

            const viewportObserver = new MutationObserver(adjustViewport);
            viewportObserver.observe(document.getElementById('viewport'), {
                attributes: true,
                attributeFilter: ['style']
            });

            // manually adjust the viewport height on-load
            adjustViewport();
        });
        </script>
    </head>
    <body>
        <!-- <div id="main"></div> -->
        <div class="uk-section uk-section-primary uk-height-max-small">
            <div class="uk-container">
                Header and toolbar goes here
            </div>
        </div>   
        <div class="uk-section uk-overflow-auto" uk-height-viewport="expand: true" id="viewport">
            <div class="uk-container" id="main"></div>
        </div>
        <div class="uk-section uk-section-primary uk-height-max-small">
            <div class="uk-container">
                Footer, totals and graph? goes here
            </div>
        </div>        
    </body>
</html>